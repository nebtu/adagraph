% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulation.R
\name{sim_trial}
\alias{sim_trial}
\title{Run a series of simulated trials according to a specified design}
\usage{
sim_trial(
  design,
  runs1,
  runs2,
  adapt_rule,
  data_gen_1,
  data_gen_2,
  include_designs = FALSE
)
}
\arguments{
\item{design}{cer_design or multiarm_design object to be used for the simulation}

\item{runs1}{Number of trials to run in the first stage}

\item{runs2}{Number of second stage to run for every first stage trial}

\item{adapt_rule}{function that takes a cer_design object after the
first interim test and returns the same object with appropiate adaptions}

\item{data_gen_1}{function for generating first stage data, see details}

\item{data_gen_2}{function for generating second stage data, see details}

\item{include_designs}{boolean indicating whether to include
the designs objects in the output}
}
\value{
A dataframe containing the various results
}
\description{
Run a series of simulated trials according to a specified design
}
\details{
data_gen_1 and data_gen_2 should take two arguments,
the number of trials to simulate and the adapted design object,
and return a matrix or dataframe with each row being the p-values
for a single trial.

See also \code{get_data_gen()} and \code{get_data_gen_2()} for further information on
how the input and output of data generating functions should look.
}
\examples{
as <- function(x,t) 2-2*pnorm(qnorm(1-x/2)/sqrt(t))
design <- multiarm_cer_design(
 controls = 1,
 treatment_assoc = c(1,1),
 n_controls = 50,
 n_treatments = 50,
 weights = c(0.5, 0.5),
 alpha = 0.05,
 test_m = rbind(c(0, 1),
              c(1, 0)),
 alpha_spending_f = as,
 t = 0.5)

adaption <- function(design) {
  design |> multiarm_drop_arms(1)
}

data_gen <- get_data_gen(
  matrix(1),
  rbind(
   c(1, 0.5),
   c(0.5, 1)
 ),
  c(0, 0.3),
  100,
  100
)

data_gen_2 <- get_data_gen_2(
  matrix(1),
  rbind(
   c(1, 0.5),
   c(0.5, 1)
  ),
  c(0, 0)
)

sim_trial(
  design,
  5,
  3,
  adaption,
  data_gen,
  data_gen_2
)

}
